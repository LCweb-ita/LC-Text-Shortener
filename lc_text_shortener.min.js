/* ------------------------------------------------------------------------
	* LC text shortener
	*
	* @version: 	1.0
	* @requires:	jQuery v1.5 or later
	* @author:		Luca Montanari (LCweb)
	* @website:		http://www.lcweb.it
	
	* Licensed under the MIT license
------------------------------------------------------------------------- */

(function(b){b.fn.lc_txt_shortener=function(e,n,h){var c=b(this);"undefined"==typeof lcts_data&&(lcts_data={});"undefined"==typeof e&&(e="..");if("undefined"==typeof h)h=["br"];else{var k=["br"],r=["a","strong","em","p"],t=h.split(",");b.each(t,function(e,a){-1!==b.inArray(b.trim(a),r)&&k.push(b.trim(a))});h=k}var q=function(u){c.each(function(){var a=b(this),d=b(this).attr("lcts-id");if("undefined"!=typeof u&&"undefined"==typeof d)return!0;"undefined"==typeof d?(d=Math.round((new Date).getTime()+
100*Math.random()),b(this).attr("lcts-id",d),lcts_data[d]={orig_txt:a.html(),end_txt:e,allowed_tags:h}):(a.html(lcts_data[d].orig_txt),a.removeClass("lcnb_shorten"));a.find("*:empty").not("br, img, i").remove();var f=a.outerHeight(!0),c="undefined"!=typeof n&&n?parseInt(n):a.parent().height();if(c<f){a.html();a.addClass("lcnb_shorten");a.find("*").lcts_remove_all_attr();a.find("*").not(lcts_data[d].allowed_tags.join(",")).each(function(){var a=b(this).contents();b(this).replaceWith(a)});for(var p=
a.html().split(" "),l="",g="",m=f=0;f<c&&m<p.length;)"undefined"!=typeof p[m]&&(g=l,l=l+p[m]+" ",a.html(l+' <span class="lcts_end_txt">'+lcts_data[d].end_txt+"</span>"),f=a.outerHeight(!0),m++);for(;a.find(".lcts_end_txt").prev().is("br");)a.find("br").last().remove();var k=lcts_data[d].allowed_tags;b.each(k,function(b,d){if("br"==d)return!0;var f=g.match("<"+d,"g"),c=g.match("</"+d,"g");null!=f&&(null!=f&&null==c||f.length>c.length)&&(g=g+"</"+d+">");b==k.length-1&&(a.html(g+'<span class="lcts_end_txt">'+
e+"</span>"),a.find("*:empty").not("br").remove())});a.find("p").last().css("display","inline")}})};b.fn.lcts_remove_all_attr=function(){return this.each(function(){var c=b.map(this.attributes,function(a){return a.name}),a=b(this);b.each(c,function(b,c){"href"!=c&&"target"!=c&&a.removeAttr(c)})})};b(window).resize(function(){"undefined"!=typeof lcts_debounce&&clearTimeout(lcts_debounce);lcts_debounce=setTimeout(function(){c.trigger("lcts_resize")},75)});c.unbind("lcts_resize");c.bind("lcts_resize",
function(){q(!0)});return q()};b.fn.lc_txt_unshorten=function(){return this.each(function(){var e=b(this).attr("lcts-id");if("undefined"==typeof e)return!0;b(this).html(lcts_data[e].orig_txt);b(this).unbind("lcts_resize");b(this).removeClass("lcnb_shorten").removeAttr("lcts-id");lcts_data[e]=!1})}})(jQuery);